# üñºÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram

## üéØ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!**

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∞–≤–∞—Ç–∞—Ä–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –æ—Ç–∑—ã–≤–∞—Ö —Ç–æ–≤–∞—Ä–æ–≤.

## üîç **–ü—Ä–æ–±–ª–µ–º–∞:**

–ê–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å –æ—Ç–∑—ã–≤–∞–º–∏, —Ö–æ—Ç—è –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å—Å—è –∏–∑ Telegram.

## üîß **–†–µ—à–µ–Ω–∏–µ:**

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –≤ API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Ñ—É–Ω–∫—Ü–∏–∏ `saveTelegramUser` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–≤–µ–¥–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã `telegram_users`

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:

```php
// –ë—ã–ª–æ:
$db->update('telegram_users', [
  'username' => $user['username'],
  'first_name' => $user['first_name'],
  'last_name' => $user['last_name'],
  'photo_url' => $user['photo_url'],
  'last_seen' => date('Y-m-d H:i:s')
], 'telegram_user_id = ?', [$user['id']]);

// –°—Ç–∞–ª–æ:
$db->update('telegram_users', [
  'telegram_username' => $user['username'],
  'telegram_first_name' => $user['first_name'],
  'telegram_last_name' => $user['last_name'],
  'telegram_avatar' => $user['photo_url'],
  'updated_at' => date('Y-m-d H:i:s')
], 'telegram_id = ?', [$user['id']]);
```

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ `telegram_id`

```php
// –ë—ã–ª–æ:
$existing = $db->fetchOne(
  "SELECT id FROM telegram_users WHERE telegram_user_id = ?",
  [$user['id']]
);

// –°—Ç–∞–ª–æ:
$existing = $db->fetchOne(
  "SELECT telegram_id FROM telegram_users WHERE telegram_id = ?",
  [$user['id']]
);
```

### 3. **–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥–ª–∏ –∏–º–µ—Ç—å —Å—Ç–∞—Ä—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `fix-telegram-users-data.php` –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

### 4. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–æ –±—ã–ª–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∞–≤–∞—Ç–∞—Ä–∫–∞–º–∏
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª—å

```javascript
console.log('Creating review element:', {
  reviewId: review.id,
  ratingRaw: review.rating,
  ratingParsed: rating,
  ratingType: typeof review.rating,
  telegramAvatar: review.telegram_avatar,
  telegramUsername: review.telegram_username,
})
```

## üéØ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

### –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–∫:

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Telegram –≤–∏–¥–∂–µ—Ç
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:** API –ø–æ–ª—É—á–∞–µ—Ç `photo_url` –æ—Ç Telegram
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:** –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–æ–ª–µ `telegram_avatar`
4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:** –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–∑—ã–≤–æ–≤ –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –∏–∑ –ë–î

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `telegram_users`:

```sql
CREATE TABLE `telegram_users` (
  `telegram_id` bigint(20) NOT NULL,
  `telegram_username` varchar(100) DEFAULT NULL,
  `telegram_first_name` varchar(100) DEFAULT NULL,
  `telegram_last_name` varchar(100) DEFAULT NULL,
  `telegram_avatar` varchar(500) DEFAULT NULL,  -- URL –∞–≤–∞—Ç–∞—Ä–∞
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`telegram_id`)
);
```

## üìÅ **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

1. **`api/telegram-auth.php`** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π
2. **`includes/product-reviews-widget.php`** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞
3. **`fix-telegram-users-data.php`** - —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–æ–≤—ã–π)

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

### 1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö:**

```bash
php fix-telegram-users-data.php
```

### 2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:**

- –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
- –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–≤–∞—Ç–∞—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å

### 3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤:**

- –û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–≤–∞—Ç–∞—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:**

- –û—Ç–∫—Ä–æ–π—Ç–µ F12 ‚Üí Console
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ `telegramAvatar`

## ‚úÖ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

- ‚úÖ –ê–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –æ—Ç–∑—ã–≤–∞—Ö
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–± –∞–≤–∞—Ç–∞—Ä–∫–∞—Ö
- ‚úÖ –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–º–æ–≥–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

## üö® **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è:**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:** `php fix-telegram-users-data.php`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:** –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –∞–≤–∞—Ç–∞—Ä–æ–∫
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:** –ü–æ–ª–µ `telegram_avatar` –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å URL
4. **–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞:** Ctrl+F5

## üéâ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

–¢–µ–ø–µ—Ä—å –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –æ—Ç–∑—ã–≤–∞—Ö —Ç–æ–≤–∞—Ä–æ–≤! –ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram –∞–≤–∞—Ç–∞—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –æ—Ç–∑—ã–≤–∞—Ö.

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** üåü
