# üîç –û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–∫–∏ "Invalid action"

## üéØ **–ü—Ä–æ–±–ª–µ–º–∞:**

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –æ—à–∏–±–∫–∞ **"Invalid action."** –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ "–û–¥–æ–±—Ä–∏—Ç—å" –∏ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å".

## üîß **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞:**

–Ø –¥–æ–±–∞–≤–∏–ª –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. **–í —Ñ–∞–π–ª–µ `admin/reviews.php`:**

```php
// Handle actions
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action'])) {
    error_log("POST request received. Action: " . ($_POST['action'] ?? 'not set') . ", Data: " . json_encode($_POST));

    if (!verifyCSRFToken($_POST['csrf_token'] ?? '')) {
        error_log("CSRF token verification failed");
        $_SESSION['error_message'] = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.';
    } else {
        error_log("CSRF token verified, calling handleReviewAction");
        error_log("Function exists: " . (function_exists('handleReviewAction') ? 'YES' : 'NO'));
        try {
            $result = handleReviewAction($_POST);
            error_log("handleReviewAction result: " . json_encode($result));
        } catch (Throwable $th) {
            error_log("Exception in handleReviewAction: " . $th->getMessage());
            $result = ['success' => false, 'message' => 'Server error: ' . $th->getMessage(), 'trace' => $th->getTraceAsString()];
        }
```

### 2. **–í —Ñ–∞–π–ª–µ `admin-functions.php`:**

```php
function handleReviewAction($data)
{
    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    error_log("handleReviewAction called with data: " . json_encode($data));

    $action = $data['action'] ?? '';
    $reviewId = $data['review_id'] ?? '';

    error_log("Action: '$action', Review ID: '$reviewId'");

    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...

    error_log("Processing action: '$action'");
    switch ($action) {
        // ... cases ...
        default:
            error_log("Unknown action: '$action'");
            return ['success' => false, 'message' => 'Invalid action.'];
    }
}
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

### 1. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–û–¥–æ–±—Ä–∏—Ç—å":**

- –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É ‚Üí –û—Ç–∑—ã–≤—ã
- –ù–∞–π–¥–∏—Ç–µ –æ—Ç–∑—ã–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–û–∂–∏–¥–∞–µ—Ç"
- –ù–∞–∂–º–∏—Ç–µ "–û–¥–æ–±—Ä–∏—Ç—å"
- –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ

### 2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**

–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏:

- `POST request received. Action: approve, Data: {...}`
- `CSRF token verified, calling handleReviewAction`
- `Function exists: YES` –∏–ª–∏ `Function exists: NO`
- `handleReviewAction called with data: {...}`
- `Action: 'approve', Review ID: '...'`
- `Processing action: 'approve'`

### 3. **–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

#### ‚úÖ **–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞:**

```
Function exists: YES
handleReviewAction called with data: {"action":"approve","review_id":"123","csrf_token":"..."}
Action: 'approve', Review ID: '123'
Processing action: 'approve'
```

#### ‚ùå **–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:**

```
Function exists: NO
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞ `admin-functions.php`

#### ‚ùå **–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è:**

```
Action: '', Review ID: ''
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–±–ª–µ–º–∞ —Å JavaScript —Ñ—É–Ω–∫—Ü–∏—è–º–∏

#### ‚ùå **–ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è:**

```
Unknown action: 'approve'
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–±–ª–µ–º–∞ —Å switch statement

## üìã **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. **–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** - –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å, –≥–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π
2. **–ü–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å action –∏ review_id
3. **–°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–∏ `handleReviewAction`
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è** - –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π case

## üéØ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏ –º—ã —Å–º–æ–∂–µ–º —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å:

- ‚úÖ –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –ª–∏ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è `handleReviewAction`
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ì–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π

## üìù **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–Ω–æ–ø–∫—É** "–û–¥–æ–±—Ä–∏—Ç—å"
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
3. **–°–æ–æ–±—â–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - –∫–∞–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤–∏–ª–∏—Å—å –≤ –ª–æ–≥–∞—Ö
4. **–ù–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≥–æ–≤** –∏—Å–ø—Ä–∞–≤–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É

**–û—Ç–ª–∞–¥–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏.** üîç
