<?php
/**
 * –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ AI-—Å—Ç–∞—Ç–µ–π
 */

echo "<h1>üß™ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ AI-—Å—Ç–∞—Ç–µ–π</h1>";

// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
$test_article = [
    'title' => '–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è: –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è —Å—Ç—Ä–µ—Å—Å–∞',
    'content' => '<h1>–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è: –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è —Å—Ç—Ä–µ—Å—Å–∞</h1><p>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ AI-—Å—Ç–∞—Ç–µ–π. –û–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä–µ—Å—Å–µ –∏ —Å–ø–æ—Å–æ–±–∞—Ö –µ–≥–æ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è.</p><h2>–ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç—Ä–µ—Å—Å?</h2><p>–°—Ç—Ä–µ—Å—Å - —ç—Ç–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª–∏. –í –º–∞–ª—ã—Ö –¥–æ–∑–∞—Ö –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º, –Ω–æ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç—Ä–µ—Å—Å –≤—Ä–µ–¥–µ–Ω –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è.</p><h2>–°–ø–æ—Å–æ–±—ã –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å–∞</h2><ul><li>–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</li><li>–ú–µ–¥–∏—Ç–∞—Ü–∏—è</li><li>–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</li><li>–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ</li></ul><p>–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö —Ç–µ—Ö–Ω–∏–∫ –ø–æ–º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ –∏ —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏.</p>',
    'excerpt' => '–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è –æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ —Å—Ç—Ä–µ—Å—Å–∞ –∏ —Å–ø–æ—Å–æ–±–∞—Ö –µ–≥–æ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è. –°–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –∏ —Ç–µ—Ö–Ω–∏–∫–∏.',
    'author' => 'AI Assistant',
    'tags' => '—Å—Ç—Ä–µ—Å—Å, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è, —Å–∞–º–æ–ø–æ–º–æ—â—å, –º–µ–¥–∏—Ç–∞—Ü–∏—è',
    'category_id' => 1,
    'featured_image' => 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800',
    'meta_title' => '–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è: –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è —Å—Ç—Ä–µ—Å—Å–∞',
    'meta_description' => '–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è –æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ —Å—Ç—Ä–µ—Å—Å–∞ –∏ —Å–ø–æ—Å–æ–±–∞—Ö –µ–≥–æ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è'
];

echo "<h2>üìù –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:</h2>";
echo "<pre>" . json_encode($test_article, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . "</pre>";

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ API
$url = 'https://cherkas-therapy.ru/upload_ai_article.php';
$data = json_encode($test_article, JSON_UNESCAPED_UNICODE);

$options = [
    'http' => [
        'header' => [
            'Content-Type: application/json',
            'User-Agent: Test-Script/1.0'
        ],
        'method' => 'POST',
        'content' => $data
    ]
];

$context = stream_context_create($options);
$result = file_get_contents($url, false, $context);

echo "<h2>üì§ –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏:</h2>";

if ($result === FALSE) {
    echo "<div style='background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0;'>";
    echo "<h3>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>";
    echo "<p>–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API</p>";
    echo "</div>";
} else {
    $response = json_decode($result, true);
    
    if ($response && $response['success']) {
        echo "<div style='background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0;'>";
        echo "<h3>‚úÖ –°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!</h3>";
        echo "<p><strong>ID:</strong> {$response['id']}</p>";
        echo "<p><strong>Slug:</strong> {$response['slug']}</p>";
        echo "<p><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> {$response['title']}</p>";
        echo "<p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> {$response['message']}</p>";
        echo "</div>";
        
        echo "<h3>üîó –°—Å—ã–ª–∫–∏:</h3>";
        echo "<p><a href='https://cherkas-therapy.ru/article.php?slug={$response['slug']}' target='_blank'>–û—Ç–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç—å—é –Ω–∞ —Å–∞–π—Ç–µ</a></p>";
        echo "<p><a href='https://cherkas-therapy.ru/admin/articles.php' target='_blank'>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a></p>";
        
    } else {
        echo "<div style='background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0;'>";
        echo "<h3>‚ùå –û—à–∏–±–∫–∞ API</h3>";
        echo "<p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> " . ($response['message'] ?? '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') . "</p>";
        echo "<p><strong>–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong></p>";
        echo "<pre>" . htmlspecialchars($result) . "</pre>";
        echo "</div>";
    }
}

echo "<h2>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:</h2>";

try {
    $config = require 'config.php';
    $dsn = "mysql:host={$config['database']['host']};port={$config['database']['port']};dbname={$config['database']['dbname']};charset={$config['database']['charset']}";
    $pdo = new PDO($dsn, $config['database']['username'], $config['database']['password'], $config['database']['options']);
    
    $stmt = $pdo->prepare("SELECT id, title, slug, author, created_at FROM articles WHERE author = 'AI Assistant' ORDER BY created_at DESC LIMIT 5");
    $stmt->execute();
    $articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
    
    if ($articles) {
        echo "<table border='1' cellpadding='10' cellspacing='0' style='border-collapse: collapse; width: 100%;'>";
        echo "<tr><th>ID</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>Slug</th><th>–ê–≤—Ç–æ—Ä</th><th>–î–∞—Ç–∞</th></tr>";
        
        foreach ($articles as $article) {
            echo "<tr>";
            echo "<td>{$article['id']}</td>";
            echo "<td>" . htmlspecialchars($article['title']) . "</td>";
            echo "<td>" . htmlspecialchars($article['slug']) . "</td>";
            echo "<td>{$article['author']}</td>";
            echo "<td>{$article['created_at']}</td>";
            echo "</tr>";
        }
        
        echo "</table>";
    } else {
        echo "<p>AI-—Å—Ç–∞—Ç—å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>";
    }
    
} catch (Exception $e) {
    echo "<p style='color: red;'>–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: " . $e->getMessage() . "</p>";
}

echo "<h2>üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç:</h2>";
echo "<p><a href='test_ai_upload.php'>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç —Å–Ω–æ–≤–∞</a></p>";
?>
